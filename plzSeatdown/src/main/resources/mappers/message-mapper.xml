<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="messageMapper">
	<resultMap type="Message" id="messageResultSet">
		<id property="messageNo" column="MESSAGE_NO"/>
		<result property="messageSenderNo" column="MESSAGE_SENDER_NO"/>
		<result property="messageReceiverNo" column="MESSAGE_RECEIVER_NO"/>
		<result property="messageContent" column="MESSAGE_CONTENT"/>
		<result property="messageDate" column="MESSAGE_DT"/>
		<result property="messageStatus" column="MESSAGE_STATUS"/>
		<result property="senderNickname" column="SENDER_NICKNM"/>
		<result property="receiverNickname" column="RECEIVER_NICKNM"/>
	</resultMap>


	<!-- 받은 쪽지 -->
	<!-- 전체 게시글 수 조회 -->
   <select id="getListCount" parameterType="string" resultType="_int">
        SELECT COUNT(*) FROM V_MESSAGE
        WHERE RECEIVER_NICKNM = #{nickName}
     ORDER BY MESSAGE_NO DESC
   </select>	
	<!-- 게시글 목록 조회 -->
	<select id="selectList" parameterType="string" resultMap="messageResultSet">
      SELECT *
      FROM V_MESSAGE
      WHERE RECEIVER_NICKNM = #{nickName}
      ORDER BY MESSAGE_NO DESC
   </select>
	
	<!-- 다음 번호 조회용 -->
	<select id="selectNextNo" resultType="_int">
		SELECT SEQ_MSGNO.NEXTVAL
		FROM DUAL
	</select>
	
	<!-- 쪽지 DB 저장 -->
	<insert id="insertMessage" parameterType="map">
		INSERT INTO MESSAGE VALUES
		(#{messageNo}, #{messageSenderNo}, #{messageReceiverNo}, #{messageContent}, DEFAULT, DEFAULT)
	</insert>
	
	<!-- 보낸 쪽지 -->
	<!-- 보낸 쪽지 수 조회 -->
	<select id="getListCount2" parameterType="string" resultType="_int">
        SELECT COUNT(*) FROM V_MESSAGE
        WHERE SENDER_NICKNM = #{nickName}
     ORDER BY MESSAGE_NO DESC
   </select>
	
	<!-- 보낸 쪽지 목록 조회 -->
	<select id="selectList2" parameterType="string" resultMap="messageResultSet">
      SELECT *
      FROM V_MESSAGE
      WHERE SENDER_NICKNM = #{nickName}
      ORDER BY MESSAGE_NO DESC
   </select>
   
	<!-- 쪽지 상세보기 -->
	<select id="selectMessage" parameterType="_int" resultMap="messageResultSet">
   		SELECT *
   		FROM V_MESSAGE
   		WHERE MESSAGE_NO=#{no}
	</select>
   
	
</mapper>